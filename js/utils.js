function respecBuyables(e){(player[e].noRespecConfirm||confirm(tmp[e].buyables.respecMessage??'Are you sure you want to respec? This will force you to do a "'+(tmp[e].name?tmp[e].name:e)+'" reset as well!'))&&(layers[e].buyables.respec(),updateBuyableTemp(e),document.activeElement.blur())}function canAffordUpgrade(e,t){const a=tmp[e].upgrades[t];if(tmp[e].deactivated)return!1;if(!1===tmp[e].upgrades[t].canAfford)return!1;const n=a.cost;return void 0===n||canAffordPurchase(e,a,n)}function canBuyBuyable(e,t){const a=temp[e].buyables[t];return a.unlocked&&run(a.canAfford,a)&&player[e].buyables[t].lt(a.purchaseLimit)&&!tmp[e].deactivated}function canAffordPurchase(e,t,a){if(t.currencyInternalName){const e=t.currencyInternalName;if(t.currencyLocation)return!t.currencyLocation[e].lt(a);if(t.currencyLayer){const n=t.currencyLayer;return!player[n][e].lt(a)}return!player[e].lt(a)}return!player[e].points.lt(a)}function buyUpgrade(e,t){buyUpg(e,t)}function buyUpg(e,t){if(!tmp[e].upgrades||!tmp[e].upgrades[t])return;let a=tmp[e].upgrades[t];if(!player[e].unlocked||tmp[e].deactivated)return;if(!tmp[e].upgrades[t].unlocked)return;if(player[e].upgrades.includes(t))return;if(!1===a.canAfford)return;let n=layers[e].upgrades[t].pay;if(void 0!==n)run(n,layers[e].upgrades[t]);else{let n=tmp[e].upgrades[t].cost;if(a.currencyInternalName){let e=a.currencyInternalName;if(a.currencyLocation){if(a.currencyLocation[e].lt(n))return;a.currencyLocation[e]=a.currencyLocation[e].sub(n)}else if(a.currencyLayer){let t=a.currencyLayer;if(player[t][e].lt(n))return;player[t][e]=player[t][e].sub(n)}else{if(player[e].lt(n))return;player[e]=player[e].sub(n)}}else{if(player[e].points.lt(n))return;player[e].points=player[e].points.sub(n)}}player[e].upgrades.push(t),void 0!==a.onPurchase&&run(a.onPurchase,a),needCanvasUpdate=!0}function buyMaxBuyable(e,t){player[e].unlocked&&tmp[e].buyables[t].unlocked&&tmp[e].buyables[t].canBuy&&layers[e].buyables[t].buyMax&&(run(layers[e].buyables[t].buyMax,layers[e].buyables[t]),updateBuyableTemp(e))}function buyBuyable(e,t){player[e].unlocked&&tmp[e].buyables[t].unlocked&&tmp[e].buyables[t].canBuy&&(run(layers[e].buyables[t].buy,layers[e].buyables[t]),updateBuyableTemp(e))}function clickClickable(e,t){player[e].unlocked&&!tmp[e].deactivated&&tmp[e].clickables[t].unlocked&&tmp[e].clickables[t].canClick&&(run(layers[e].clickables[t].onClick,layers[e].clickables[t]),updateClickableTemp(e))}function clickGrid(e,t){player[e].unlocked&&!tmp[e].deactivated&&run(layers[e].grid.getUnlocked,layers[e].grid,t)&&gridRun(e,"getCanClick",player[e].grid[t],t)&&gridRun(e,"onClick",player[e].grid[t],t)}function inChallenge(e,t){const a=player[e].activeChallenge;return!!a&&(a==(t=toNumber(t))||!!layers[e].challenges[a].countsAs&&tmp[e].challenges[a].countsAs.includes(t))}let onTreeTab=!0;function showTab(e,t){if(LAYERS.includes(e)&&!layerunlocked(e))return;player.tab!==e&&clearParticles((function(e){return e.layer===player.tab})),tmp[e]&&player.tab===e&&isPlainObject(tmp[e].tabFormat)&&(player.subtabs[e].mainTabs=Object.keys(layers[e].tabFormat)[0]);player.tab=e,tmp[e]&&"side"!==tmp[e].row&&"otherside"!==tmp[e].row&&(player.lastSafeTab=e),updateTabFormats(),needCanvasUpdate=!0,document.activeElement.blur()}function showNavTab(e,t){if(console.log(t),!LAYERS.includes(e)||layerunlocked(e)){player.navTab!==e&&clearParticles((function(e){return e.layer===player.navTab})),tmp[e]&&void 0!==tmp[e].previousTab&&(t=tmp[e].previousTab);console.log(e+t),"none"!==e&&t&&!tmp[t]?.leftTab==!tmp[e]?.leftTab?player[e].prevTab=t:player[e]&&(player[e].prevTab=""),player.navTab=e,updateTabFormats(),needCanvasUpdate=!0}}function goBack(e){let t="none";player[e].prevTab&&(t=player[e].prevTab),"none"!==player.navTab||"side"!=tmp[e]?.row&&"otherside"!=tmp[e].row||(t=player.lastSafeTab),tmp[e].leftTab?showNavTab(t,e):showTab(t,e)}function layOver(e,t){for(const a in t)t[a]instanceof Decimal?e[a]=new Decimal(t[a]):"object"==typeof t[a]?layOver(e[a],t[a]):e[a]=t[a]}function prestigeNotify(e){if(layers[e].prestigeNotify)return layers[e].prestigeNotify();if(isPlainObject(tmp[e].tabFormat))for(subtab in tmp[e].tabFormat)if(subtabResetNotify(e,"mainTabs",subtab))return!0;for(family in tmp[e].microtabs)for(subtab in tmp[e].microtabs[family])if(subtabResetNotify(e,family,subtab))return!0;return!tmp[e].autoPrestige&&!tmp[e].passiveGeneration&&("static"===tmp[e].type?tmp[e].canReset:"normal"===tmp[e].type&&(tmp[e].canReset&&tmp[e].resetGain.gte(player[e].points.div(10))))}function notifyLayer(e){player.tab!==e&&layerunlocked(e)&&(player.notify[e]=1)}function subtabShouldNotify(e,t,a){let n={};return n="mainTabs"==t?tmp[e].tabFormat[a]:tmp[e].microtabs[t][a],!!n.unlocked&&(n.embedLayer?tmp[n.embedLayer].notify:n.shouldNotify)}function subtabResetNotify(e,t,a){let n={};return n="mainTabs"===t?tmp[e].tabFormat[a]:tmp[e].microtabs[t][a],n.embedLayer?tmp[n.embedLayer].prestigeNotify:n.prestigeNotify}function nodeShown(e){return layerShown(e)}function layerunlocked(e){return tmp[e]&&"none"==tmp[e].type?player[e].unlocked:LAYERS.includes(e)&&(player[e].unlocked||tmp[e].canReset&&tmp[e].layerShown)}function keepGoing(){player.keepGoing=!0,needCanvasUpdate=!0}function toNumber(e){return e instanceof Decimal?e.toNumber():"string"==typeof e?Number.parseFloat(e):e}function updateMilestones(e){if(!tmp[e].deactivated)for(id in layers[e].milestones)!hasMilestone(e,id)&&layers[e].milestones[id].done()&&(player[e].milestones.push(id),layers[e].milestones[id].onComplete&&layers[e].milestones[id].onComplete(),(tmp[e].milestonePopups||void 0===tmp[e].milestonePopups)&&doPopup("milestone",tmp[e].milestones[id].requirementDescription,"Milestone Gotten!",3,tmp[e].color),player[e].lastMilestone=id)}function updateAchievements(e){if(!tmp[e].deactivated)for(id in layers[e].achievements)isPlainObject(layers[e].achievements[id])&&!hasAchievement(e,id)&&layers[e].achievements[id].done()&&(player[e].achievements.push(id),layers[e].achievements[id].onComplete&&layers[e].achievements[id].onComplete(),(tmp[e].achievementPopups||void 0===tmp[e].achievementPopups)&&doPopup("achievement",tmp[e].achievements[id].name,"Achievement Gotten!",3,tmp[e].color))}function addTime(e,t){let a=player,n=a.timePlayed;t&&(a=a[t],n=a.time),n+0!==n&&(console.log("Memory leak detected. Trying to fix..."),n=toNumber(n),(isNaN(n)||0==n)&&(console.log("Couldn't fix! Resetting..."),n=t?player.timePlayed:0,t||(player.timePlayedReset=!0))),n+=toNumber(e),t?a.time=n:a.timePlayed=n}let shiftDown=!1,ctrlDown=!1;document.onkeydown=function(e){if(void 0===player)return;if(shiftDown=e.shiftKey,ctrlDown=e.ctrlKey,tmp.gameEnded&&!player.keepGoing)return;let t=e.key;if(ctrlDown&&(t="ctrl+"+t),!onFocused&&(ctrlDown&&hotkeys[t]&&e.preventDefault(),hotkeys[t])){const e=hotkeys[t];player[e.layer].unlocked&&tmp[e.layer].hotkeys[e.id].unlocked&&e.onPress()}},document.onkeyup=function(e){shiftDown=e.shiftKey,ctrlDown=e.ctrlKey};let onFocused=!1;function focused(e){onFocused=e}function isFunction(e){return"function"==typeof e}function isPlainObject(e){return e&&e.constructor===Object}function toValue(e,t){return t instanceof Decimal?(e=new Decimal(e),checkDecimalNaN(e)?Decimal.dZero:e):parseFloat(e)||0}document.title=modInfo.name;const activePopups=[];let popupID=0;function doPopup(e="none",t="This is a test popup.",a="",n=3,r=""){switch(e){case"achievement":a="Achievement Unlocked!",e="achievement-popup";break;case"challenge":a="Challenge Complete",e="challenge-popup";break;default:a="Something Happened?",e="default-popup"}activePopups.push({timer:n,type:e,title:a,message:t+"\n",id:popupID,color:r}),popupID++}function adjustPopupTime(e){for(const t of activePopups)t.time-=e,t.time<0&&activePopups.splice(activePopups.indexOf(t),1)}function run(e,t,...a){return isFunction(e)?e.call(t,...a):e}function gridRun(e,t,a,n){if(isFunction(layers[e].grid[t])){return layers[e].grid[t].bind(layers[e].grid)(a,n)}return layers[e].grid[t]}
